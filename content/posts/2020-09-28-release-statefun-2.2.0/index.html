
<!DOCTYPE html>
<html lang="en" dir=>

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta name="generator" content="Hugo 0.110.0">
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="The Apache Flink community is happy to announce the release of Stateful Functions (StateFun) 2.2.0! This release introduces major features that extend the SDKs, such as support for asynchronous functions in the Python SDK, new persisted state constructs, and a new SDK that allows embedding StateFun functions within a Flink DataStream job. Moreover, we&rsquo;ve also included important changes that improve out-of-the-box stability for common workloads, as well as increased observability for operational purposes.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Stateful Functions 2.2.0 Release Announcement" />
<meta property="og:description" content="The Apache Flink community is happy to announce the release of Stateful Functions (StateFun) 2.2.0! This release introduces major features that extend the SDKs, such as support for asynchronous functions in the Python SDK, new persisted state constructs, and a new SDK that allows embedding StateFun functions within a Flink DataStream job. Moreover, we&rsquo;ve also included important changes that improve out-of-the-box stability for common workloads, as well as increased observability for operational purposes." />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:1313/posts/2020-09-28-release-statefun-2.2.0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-28T08:00:00+00:00" />
<meta property="article:modified_time" content="2020-09-28T08:00:00+00:00" />
<title>Stateful Functions 2.2.0 Release Announcement | Apache Flink</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e3b33391dbc1f4b2cc47778e2f4b86c744ded3ccc82fdfb6f08caf91d8607f9a.css" integrity="sha256-47MzkdvB9LLMR3eOL0uGx0Te08zIL9&#43;28Iyvkdhgf5o=">
<script defer src="/en.search.min.458fb9bb2012b392febe03660432071a1a7b3968c8a1c5b1fd677e773689a112.js" integrity="sha256-RY&#43;5uyASs5L&#43;vgNmBDIHGhp7OWjIocWx/Wd&#43;dzaJoRI="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  

<link rel="stylesheet" type="text/css" href="//localhost:1313//font-awesome/css/font-awesome.min.css">
<script src="//localhost:1313//js/anchor.min.js"></script>
<script src="//localhost:1313//js/flink.js"></script>


    
    <script>
      var _paq = window._paq = window._paq || [];
       
       
      _paq.push(['disableCookies']);
       
      _paq.push(["setDomains", ["*.flink.apache.org","*.nightlies.apache.org/flink"]]);
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//matomo.privacy.apache.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  

<nav>


<a id="logo" href="//localhost:1313/">
    <img width="70%" src="//localhost:1313//flink-header-logo.svg">
</a>
<p style="text-align:right">&#8203</p>

<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>










  




  
  
    
  
    
  
  

  <input type="checkbox" id="section-16358d95d8c031938f1ecedcfabf20ec" class="toggle"  />
  <label for="section-16358d95d8c031938f1ecedcfabf20ec" class="flex justify-between flink-menu-item">What is Apache Flink?<span>▾</span>
  </label>

    <ul>
    
      <li>
      
  

  
  
    <label for="section-6426d908303b40a8c4163518b9f85188" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/what-is-flink/flink-architecture/" class="">Architecture</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-b90894b3348d928ed138eec343c24da3" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/what-is-flink/flink-applications/" class="">Applications</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-68dd7c29c2b0bd8a5489153742d7f42c" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/what-is-flink/flink-operations/" class="">Operations</a>
    </label>
  

      </li>
    
    </ul>
  

  
    
  
    
  

  
  
    
    
    
<label for="section-f1ecec07350bd6810050d40158878749" class="flex justify-between flink-menu-item">
    <a href="https://nightlies.apache.org/flink/flink-statefun-docs-stable/" style="color:black" class="">What is Stateful Functions? <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

  

  
    
  
    
  

  
  
    
    
    
<label for="section-4113a4c3072cb35f6fd7a0d4e098ee70" class="flex justify-between flink-menu-item">
    <a href="https://nightlies.apache.org/flink/flink-ml-docs-stable/" style="color:black" class="">What is Flink ML? <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

  

  
    
  
    
  

  
  
    
    
    
<label for="section-b39c70259d0abbe2bf1d8d645425f84d" class="flex justify-between flink-menu-item">
    <a href="https://nightlies.apache.org/flink/flink-statefun-docs-stable/" style="color:black" class="">What is the Flink Kubernetes Operator? <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

  

  
    
  
    
  

  
  
    
    
    
<label for="section-53e0b1afcb9ccaf779dc285aa272a014" class="flex justify-between flink-menu-item">
    <a href="https://nightlies.apache.org/flink/flink-table-store-docs-stable/" style="color:black" class="">What is Flink Table Store? <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

  

  
    
  
    
  

  
  
    <label for="section-1264e826d9b04140e72b7ea979e453ce" class="flex justify-between flink-menu-item">
    <a href="/docs/use-cases/" class="">Use Cases</a>
    </label>
  

  

  
    
  
    
  

  
  
    <label for="section-a99f5281cf3cffa0ffd72c84a46ec6ed" class="flex justify-between flink-menu-item">
    <a href="/docs/powered-by/" class="">Powered By</a>
    </label>
  

  

  
  <br/>

  
  
    
  
    
  

  
  
    <label for="section-23af8211b981925b81d51ea7aac5177b" class="flex justify-between flink-menu-item">
    <a href="/docs/downloads/" class="">Downloads</a>
    </label>
  

  

  
    
  
    
  
  

  <input type="checkbox" id="section-f1b7c1b2e5dd43526e77637c475d35b8" class="toggle"  />
  <label for="section-f1b7c1b2e5dd43526e77637c475d35b8" class="flex justify-between flink-menu-item">Getting Started<span>▾</span>
  </label>

    <ul>
    
      <li>
      
  

  
  
    
    
    
<label for="section-f45abaa99ab076108b9a5b94edbc6647" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/try-flink/local_installation/" style="color:black" class="">With Flink <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-efe2166e9dce6f72e126dcc2396b4402" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-statefun-docs-stable/getting-started/project-setup.html" style="color:black" class="">With Flink Stateful Functions <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-7e268d0a469b1093bb33d71d093eb7b9" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-ml-docs-stable/docs/try-flink-ml/quick-start/" style="color:black" class="">With Flink ML <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-cc7147cd0441503127bfaf6f219d4fbb" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-stable/docs/try-flink-kubernetes-operator/quick-start/" style="color:black" class="">With Flink Kubernetes Operator <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-660ca694e416d8ca9176dda52a60d637" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-table-store-docs-stable/docs/try-table-store/quick-start/" style="color:black" class="">With Flink Table Store <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-75db0b47bf4ae9c247aadbba5fbd720d" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/learn-flink/overview/" style="color:black" class="">Training Course <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
    </ul>
  

  
    
  
    
  
  

  <input type="checkbox" id="section-d94c94ce01b910c37d1426ab88722008" class="toggle"  />
  <label for="section-d94c94ce01b910c37d1426ab88722008" class="flex justify-between flink-menu-item">Documentation<span>▾</span>
  </label>

    <ul>
    
      <li>
      
  

  
  
    
    
    
<label for="section-496a3536cfaecabb74f84b14fe7e4dd5" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-docs-stable/" style="color:black" class="">Flink 1.16 (stable) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-8b2fd3efb702be3783ba98d650707e3c" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-docs-master/" style="color:black" class="">Flink Master (snapshot) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-5317a079cddb964c59763c27607f43d9" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-statefun-docs-stable/" style="color:black" class="">Stateful Functions 3.2 (stable) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-25b72f108b7156e94d91b04853d8813a" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-statefun-docs-master" style="color:black" class="">Stateful Functions Master (snapshot) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-00471cb64001e69481840d4b628e4e74" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-ml-docs-stable/" style="color:black" class="">ML 2.1 (stable) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-6d895ec5ad127a29a6a9ce101328ccdf" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-ml-docs-master" style="color:black" class="">ML Master (snapshot) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-e9e531f4d1ec4e71d48416c7db95d964" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-stable/" style="color:black" class="">Kubernetes Operator 1.3 (latest) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-a2c75d90005425982ba8f26ae0e160a3" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-main" style="color:black" class="">Kubernetes Operator Main (snapshot) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-07b85e4b2f61b1526bf202c64460abcd" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-table-store-docs-stable/" style="color:black" class="">Table Store 0.3 (stable) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-9b9a0032b1e858a34c125d828d1a0718" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-table-store-docs-master/" style="color:black" class="">Table Store Master (snapshot) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
    </ul>
  

  
    
  
    
  

  
  
    <label for="section-3cecb1cf64e57b5b8605ef5eafb7aca6" class="flex justify-between flink-menu-item">
    <a href="/docs/getting-help/" class="">Getting Help</a>
    </label>
  

  

  
    
  
    
  

  
  
    
    
    
<label for="section-1d5066022b83f4732dc80f4e9eaa069a" class="flex justify-between flink-menu-item">
    <a href="https://flink-packages.org/" style="color:black" class="">flink-packages.org <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

  

  
  <br/>

  
  
    
  
    
  

  
  
    <label for="section-68d5b1d8d968218070bc0f47c2808fe6" class="flex justify-between flink-menu-item">
    <a href="/docs/community/" class="">Community & Project Info</a>
    </label>
  

  

  
    
  
    
  

  
  
    <label for="section-6c9676d04bcc83fa71363dcc910384b6" class="flex justify-between flink-menu-item">
    <a href="/docs/roadmap/" class="">Roadmap</a>
    </label>
  

  

  
    
  
    
  
  

  <input type="checkbox" id="section-475e0697dc78af4fbb6e9cefbb6bca5d" class="toggle"  />
  <label for="section-475e0697dc78af4fbb6e9cefbb6bca5d" class="flex justify-between flink-menu-item">How to Contribute<span>▾</span>
  </label>

    <ul>
    
      <li>
      
  

  
  
    <label for="section-526780e359726ac277d18547d4a94c43" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/overview/" class="">Overview</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-61f8b74592eb19f72b5d69ce76028bc6" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/contribute-code/" class="">Contribute Code</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-ded112d03122849cf92a5f8734339992" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/reviewing-prs/" class="">Review Pull Requests</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-ad2f7a23b44be83e719ae6c9353f670f" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/code-style-and-quality-preamble/" class="">Code Style and Quality Guide</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-79a9e93c91f0d81bd63e432a26d8ac1c" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/contribute-documentation/" class="">Contribute Documentation</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-eb25ced8645b94b5021950989a7c9f78" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/documentation-style-guide/" class="">Documentation Style Guide</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-ff0795cd3fe6f7e97f306e5eabefc848" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/improve-website/" class="">Contribute to the Website</a>
    </label>
  

      </li>
    
    </ul>
  

  
    
  
    
  

  
  
    <label for="section-df630fc1bd1ef0f45f515c779d27c8b5" class="flex justify-between flink-menu-item">
    <a href="/docs/security/" class="">Security</a>
    </label>
  

  

  
  <br/>




  
    
  

  
  
    <label for="section-a07783f405300745807d39eacf150420" class="flex justify-between flink-menu-item">
    <a href="/posts/" class="">Flink Blog</a>
    </label>
  

  

  




















<br/>
<hr class="menu-break">

  
<label for="section-f71a7070dbb7b669824a6441408ded70" class="flex justify-between flink-menu-item">
    <a href="https://github.com/apache/flink" style="color:black" class="">Flink on GitHub <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>

  
<label for="section-2ccaaab8c67f3105bbf7df75faca8027" class="flex justify-between flink-menu-item">
    <a href="https://twitter.com/apacheflink" style="color:black" class="">@ApacheFlink <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>



<hr class="menu-break">
<table>
  <tr>
    <th colspan="2">
<label for="section-78c2028200542d78f8c1a8f6b4cbb36b" class="flex justify-between flink-menu-item">
    <a href="https://www.apache.org/" style="color:black" class="">Apache Software Foundation <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label></th>
  </tr>
  <tr>
    <td>
<label for="section-794df3791a8c800841516007427a2aa3" class="flex justify-between flink-menu-item">
    <a href="https://www.apache.org/licenses/" style="color:black" class="">License <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label></td>
    <td>
<label for="section-2fae32629d4ef4fc6341f1751b405e45" class="flex justify-between flink-menu-item">
    <a href="https://www.apache.org/security/" style="color:black" class="">Security <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label></td>
  </tr>
  <tr>
    <td>
<label for="section-0584e445d656b83b431227bb80ff0c30" class="flex justify-between flink-menu-item">
    <a href="https://www.apache.org/foundation/sponsorship.html" style="color:black" class="">Donate <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label></td>
    <td>
<label for="section-00d06796e489999226fb5bb27fe1b3b2" class="flex justify-between flink-menu-item">
    <a href="https://www.apache.org/foundation/thanks.html" style="color:black" class="">Thanks <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label></td>
  </tr>
</table>

<hr class="menu-break">



  

  







<a  href="//localhost:1313/zh/" class="flex align-center">
  <i class="fa fa-globe" aria-hidden="true"></i>&nbsp;&nbsp;
  中文版
</a>

<script src="//localhost:1313//js/track-search-terms.js"></script>


</nav>




  <script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Stateful Functions 2.2.0 Release Announcement</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    


<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#new-features">New Features</a>
      <ul>
        <li><a href="#asynchronous-functions-in-python-sdk">Asynchronous functions in Python SDK</a></li>
        <li><a href="#flink-datastream-integration-sdk">Flink DataStream Integration SDK</a></li>
        <li><a href="#construct-for-dynamic-state-registration">Construct for Dynamic State Registration</a></li>
      </ul>
    </li>
    <li><a href="#improvements">Improvements</a>
      <ul>
        <li><a href="#remote-functions-communication-stability">Remote Functions Communication Stability</a></li>
        <li><a href="#operational-observability-of-a-statefun-application">Operational observability of a StateFun Application</a></li>
        <li><a href="#fine-grained-control-over-remote-connection-lifecycle">Fine-grained control over remote connection lifecycle</a></li>
      </ul>
    </li>
    <li><a href="#3rd-party-sdks">3rd Party SDKs</a></li>
    <li><a href="#important-patch-notes">Important Patch Notes</a></li>
    <li><a href="#release-notes">Release Notes</a></li>
    <li><a href="#list-of-contributors">List of Contributors</a></li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      




      
<article class="markdown">
    <h1>
        <a href="/posts/2020-09-28-release-statefun-2.2.0/">Stateful Functions 2.2.0 Release Announcement</a>
    </h1>
    
  September 28, 2020 -



  Tzu-Li (Gordon) Tai

  <a href="https://twitter.com/tzulitai">(@tzulitai)</a>
  

  Igal Shilman

  <a href="https://twitter.com/IgalShilman">(@IgalShilman)</a>
  



    <p><p>The Apache Flink community is happy to announce the release of Stateful Functions (StateFun) 2.2.0! This release
introduces major features that extend the SDKs, such as support for asynchronous functions in the Python SDK, new
persisted state constructs, and a new SDK that allows embedding StateFun functions within a Flink DataStream job.
Moreover, we&rsquo;ve also included important changes that improve out-of-the-box stability for common workloads,
as well as increased observability for operational purposes.</p>
<p>We&rsquo;ve also seen new 3rd party SDKs for StateFun being developed since the last release. While they are not part of the
release artifacts, it&rsquo;s great seeing these community-driven additions! We&rsquo;ve highlighted these efforts below
in this announcement.</p>
<p>The binary distribution and source artifacts are now available on the updated <a href="https://flink.apache.org/downloads.html">Downloads</a>
page of the Flink website, and the most recent Python SDK distribution is available on <a href="https://pypi.org/project/apache-flink-statefun/">PyPI</a>.
For more details, check the complete <a href="https://issues.apache.org/jira/secure/ReleaseNote.jspa?projectId=12315522&amp;version=12348350">release changelog</a>
and the <a href="//nightlies.apache.org/flinkflink-statefun-docs-release-2.2/">updated documentation</a>.
We encourage you to download the release and share your feedback with the community through the <a href="https://flink.apache.org/community.html#mailing-lists">Flink mailing lists</a>
or <a href="https://issues.apache.org/jira/browse/">JIRA</a>!
{% toc %}</p>
<h2 id="new-features">
  New Features
  <a class="anchor" href="#new-features">#</a>
</h2>
<h3 id="asynchronous-functions-in-python-sdk">
  Asynchronous functions in Python SDK
  <a class="anchor" href="#asynchronous-functions-in-python-sdk">#</a>
</h3>
<p>This release enables registering asynchronous Python functions as stateful functions by introducing a new handler
in the <a href="//nightlies.apache.org/flinkflink-statefun-docs-release-2.2/sdk/python.html">Python SDK</a>: <code>AsyncRequestReplyHandler</code>.
This allows serving StateFun functions with Python web frameworks that support asynchronous IO natively (for example,
<a href="https://pypi.org/project/aiohttp/">aiohttp</a>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">statefun</span> <span class="kn">import</span> <span class="n">StatefulFunctions</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">statefun</span> <span class="kn">import</span> <span class="n">AsyncRequestReplyHandler</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">functions</span> <span class="o">=</span> <span class="n">StatefulFunctions</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@functions.bind</span><span class="p">(</span><span class="s2">&#34;example/greeter&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">greeter</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">html</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s1">&#39;http://....&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">context</span><span class="o">.</span><span class="n">pack_and_reply</span><span class="p">(</span><span class="n">SomeProtobufMessage</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># expose this handler via an async web framework</span>
</span></span><span class="line"><span class="cl"><span class="n">handler</span> <span class="o">=</span> <span class="n">AsyncRequestReplyHandler</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span>
</span></span></code></pre></div><p>For more details, please see the docs on <a href="//nightlies.apache.org/flinkflink-statefun-docs-release-2.2/sdk/python.html#exposing-functions">exposing Python functions</a>.</p>
<h3 id="flink-datastream-integration-sdk">
  Flink DataStream Integration SDK
  <a class="anchor" href="#flink-datastream-integration-sdk">#</a>
</h3>
<p>Using this SDK, you may combine pipelines written with the Flink <code>DataStream</code> API or higher-level libraries
(such as Table API, CEP etc., basically anything that can consume or produce a <code>DataStream</code>) with the programming constructs
provided by Stateful Functions, as demonstrated below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">RoutableMessage</span><span class="o">&gt;</span> <span class="n">namesIngress</span> <span class="o">=</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">StatefulFunctionEgressStreams</span> <span class="n">egresses</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">StatefulFunctionDataStreamBuilder</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&#34;example&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">withDataStreamAsIngress</span><span class="o">(</span><span class="n">namesIngress</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">withRequestReplyRemoteFunction</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">RequestReplyFunctionBuilder</span><span class="o">.</span><span class="na">requestReplyFunctionBuilder</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">REMOTE_GREET</span><span class="o">,</span> <span class="n">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&#34;http://...&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">withPersistedState</span><span class="o">(</span><span class="s">&#34;seen_count&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">withFunctionProvider</span><span class="o">(</span><span class="n">GREET</span><span class="o">,</span> <span class="n">unused</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">MyFunction</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">withEgressId</span><span class="o">(</span><span class="n">GREETINGS</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">env</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responsesEgress</span> <span class="o">=</span> <span class="n">getDataStreamForEgressId</span><span class="o">(</span><span class="n">GREETINGS</span><span class="o">);</span>
</span></span></code></pre></div><p>Events from <code>DataStream</code> ingresses are being routed to bound functions, and events sent to
egresses are captured as <code>DataStream</code> egresses. This opens up the possibility of building complex streaming
applications.</p>
<h3 id="construct-for-dynamic-state-registration">
  Construct for Dynamic State Registration
  <a class="anchor" href="#construct-for-dynamic-state-registration">#</a>
</h3>
<p>Prior to this release, the persisted state constructs in the Java SDK, such as <code>PersistedValue</code>, <code>PersistedTable</code> etc.,
had to be eagerly defined in a stateful function&rsquo;s class. In certain scenarios, what state a function requires is not
known in advance, and may only be dynamically registered at runtime (e.g., when a function is invoked).</p>
<p>This release enables that by providing a new <code>PersistedStateRegistry</code> construct:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyFunction</span> <span class="kd">implements</span> <span class="n">StatefulFunction</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Persisted</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">PersistedStateRegistry</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PersistedStateRegistry</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">PersistedValue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">myValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Object</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">myValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">myValue</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">registerValue</span><span class="o">(</span><span class="n">PersistedValue</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;my-value&#34;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="improvements">
  Improvements
  <a class="anchor" href="#improvements">#</a>
</h2>
<h3 id="remote-functions-communication-stability">
  Remote Functions Communication Stability
  <a class="anchor" href="#remote-functions-communication-stability">#</a>
</h3>
<p>After observing common workloads, a few configurations for communicating with remote functions were adjusted for a better
out-of-the-box connection stability. This includes the following:</p>
<ul>
<li>The underlying connection pool was tuned for low latency, high throughput workloads. This allows StateFun to reuse
existing connections much more aggressively and avoid re-establishing a connection for each request.</li>
<li>StateFun applies backpressure once the total number of uncompleted requests reaches a per JVM threshold (<code>statefun.async.max-per-task</code>),
but observing typical workloads we have discovered that the default value is set too high. In this release the default
was reduced to improve stability and resource consumption, in the face of a slow-responding remote function.</li>
</ul>
<h3 id="operational-observability-of-a-statefun-application">
  Operational observability of a StateFun Application
  <a class="anchor" href="#operational-observability-of-a-statefun-application">#</a>
</h3>
<p>One major goal of this release was to take a necessary step towards supporting auto-scaling of remote functions. Towards that end,
we&rsquo;ve exposed several metrics related to workload of remote functions and resulting backpressure applied by the function
dispatchers. This includes the following:</p>
<ul>
<li>Per function type invocation duration / latency histograms</li>
<li>Per function type backlog size</li>
<li>Per JVM (StateFun worker) and per function type number of in-flight invocations</li>
</ul>
<p>The full list of metrics and their descriptions can be found <a href="//nightlies.apache.org/flinkflink-statefun-docs-release-2.2/deployment-and-operations/metrics.html">here</a>.</p>
<h3 id="fine-grained-control-over-remote-connection-lifecycle">
  Fine-grained control over remote connection lifecycle
  <a class="anchor" href="#fine-grained-control-over-remote-connection-lifecycle">#</a>
</h3>
<p>With this release, it&rsquo;s possible to set individual timeouts for overall duration and individual read and write IO operations
of HTTP requests with remote functions. You can find the corresponding field names in a function spec that defines
these timeout values <a href="//nightlies.apache.org/flinkflink-statefun-docs-release-2.2/sdk/index.html#defining-functions">here</a>.</p>
<h2 id="3rd-party-sdks">
  3rd Party SDKs
  <a class="anchor" href="#3rd-party-sdks">#</a>
</h2>
<p>Since the last release, we&rsquo;ve seen new 3rd party SDKs for different languages being implemented on top of StateFun&rsquo;s
remote function HTTP request-reply protocol, including <a href="https://github.com/sjwiesman/statefun-go/">Go</a> and <a href="https://github.com/aljoscha/statefun-rust">Rust</a> implementations. While these SDKs are not
endorsed or maintained by the Apache Flink PMC and currently not part of the current releases, it is great to see these
new additions that demonstrate the extensibility of the framework.</p>
<p>For that reason, we&rsquo;ve added
a new <a href="//nightlies.apache.org/flinkflink-statefun-docs-release-2.2/sdk/external.html">page in the documentation</a>
to list the 3rd party SDKs that the community is aware of. If you&rsquo;ve also worked on a new language SDK for StateFun that
is stable and you plan to continue maintaining, please consider letting the community know of your work by
submitting a pull request to add your project to the list!</p>
<h2 id="important-patch-notes">
  Important Patch Notes
  <a class="anchor" href="#important-patch-notes">#</a>
</h2>
<p>Below is a list of user-facing interface and configuration changes, dependency version upgrades, or removal of supported versions that would be
important to be aware of when upgrading your StateFun applications to this version:</p>
<ul>
<li>[<a href="https://issues.apache.org/jira/browse/FLINK-18812">FLINK-18812</a>] The Flink version in StateFun 2.2 has been upgraded to 1.11.1.</li>
<li>[<a href="https://issues.apache.org/jira/browse/FLINK-19203">FLINK-19203</a>] Upgraded Scala version to 2.12, and dropped support for 2.11.</li>
<li>[<a href="https://issues.apache.org/jira/browse/FLINK-19190">FLINK-19190</a>] All existing metric names have been renamed to be camel-cased instead of snake-cased, to conform with the Flink metric naming conventions. <strong>This breaks existing deployments if you depended on previous metrics</strong>.</li>
<li>[<a href="https://issues.apache.org/jira/browse/FLINK-19192">FLINK-19192</a>] The connection pool size for remote function HTTP requests have been increased to 1024, with a stale TTL of 1 minute.</li>
<li>[<a href="https://issues.apache.org/jira/browse/FLINK-19191">FLINK-19191</a>] The default max number of asynchronous operations per JVM (StateFun worker) has been decreased to 1024.</li>
</ul>
<h2 id="release-notes">
  Release Notes
  <a class="anchor" href="#release-notes">#</a>
</h2>
<p>Please review the <a href="https://issues.apache.org/jira/secure/ReleaseNote.jspa?projectId=12315522&amp;version=12348350">release notes</a>
for a detailed list of changes and new features if you plan to upgrade your setup to Stateful Functions 2.2.0.</p>
<h2 id="list-of-contributors">
  List of Contributors
  <a class="anchor" href="#list-of-contributors">#</a>
</h2>
<p>The Apache Flink community would like to thank all contributors that have made this release possible:</p>
<p>abc863377, Authuir, Chesnay Schepler, Congxian Qiu, David Anderson, Dian Fu, Francesco Guardiani, Igal Shilman, Marta Paes Moreira, Patrick Wiener, Rafi Aroch, Seth Wiesman, Stephan Ewen, Tzu-Li (Gordon) Tai, Ufuk Celebi</p>
<p>If you’d like to get involved, we’re always <a href="https://github.com/apache/flink-statefun#contributing">looking for new contributors</a>.</p>
</p>
</article>
 
      

      <footer class="book-footer">
        
  





<a href="https://cwiki.apache.org/confluence/display/FLINK/Flink+Translation+Specifications">Want to contribute translation?</a>
<br><br>
<a href="//github.com/apache/flink-web/edit/asf-site/docs/content/posts/2020-09-28-release-statefun-2.2.0.md" style="color:black"><i class="fa fa-edit fa-fw"></i>Edit This Page</a>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      


<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#new-features">New Features</a>
      <ul>
        <li><a href="#asynchronous-functions-in-python-sdk">Asynchronous functions in Python SDK</a></li>
        <li><a href="#flink-datastream-integration-sdk">Flink DataStream Integration SDK</a></li>
        <li><a href="#construct-for-dynamic-state-registration">Construct for Dynamic State Registration</a></li>
      </ul>
    </li>
    <li><a href="#improvements">Improvements</a>
      <ul>
        <li><a href="#remote-functions-communication-stability">Remote Functions Communication Stability</a></li>
        <li><a href="#operational-observability-of-a-statefun-application">Operational observability of a StateFun Application</a></li>
        <li><a href="#fine-grained-control-over-remote-connection-lifecycle">Fine-grained control over remote connection lifecycle</a></li>
      </ul>
    </li>
    <li><a href="#3rd-party-sdks">3rd Party SDKs</a></li>
    <li><a href="#important-patch-notes">Important Patch Notes</a></li>
    <li><a href="#release-notes">Release Notes</a></li>
    <li><a href="#list-of-contributors">List of Contributors</a></li>
  </ul>
</nav>

 
    </aside>
    <aside class="expand-toc">
      <button class="toc" onclick="expandToc()">
        <i class="fa fa-expand" aria-hidden="true"></i>
      </button>
    </aside>
    
  </main>

  
</body>

</html>












