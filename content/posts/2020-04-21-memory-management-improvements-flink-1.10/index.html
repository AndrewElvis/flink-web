
<!DOCTYPE html>
<html lang="en" dir=>

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta name="generator" content="Hugo 0.110.0">
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Apache Flink 1.10 comes with significant changes to the memory model of the Task Managers and configuration options for your Flink applications. These recently-introduced changes make Flink more adaptable to all kinds of deployment environments (e.g. Kubernetes, Yarn, Mesos), providing strict control over its memory consumption. In this post, we describe Flink’s memory model, as it stands in Flink 1.10, how to set up and manage memory consumption of your Flink applications and the recent changes the community implemented in the latest Apache Flink release.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Memory Management Improvements with Apache Flink 1.10" />
<meta property="og:description" content="Apache Flink 1.10 comes with significant changes to the memory model of the Task Managers and configuration options for your Flink applications. These recently-introduced changes make Flink more adaptable to all kinds of deployment environments (e.g. Kubernetes, Yarn, Mesos), providing strict control over its memory consumption. In this post, we describe Flink’s memory model, as it stands in Flink 1.10, how to set up and manage memory consumption of your Flink applications and the recent changes the community implemented in the latest Apache Flink release." />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:1313/posts/2020-04-21-memory-management-improvements-flink-1.10/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-21T12:00:00+00:00" />
<meta property="article:modified_time" content="2020-04-21T12:00:00+00:00" />
<title>Memory Management Improvements with Apache Flink 1.10 | Apache Flink</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e3b33391dbc1f4b2cc47778e2f4b86c744ded3ccc82fdfb6f08caf91d8607f9a.css" integrity="sha256-47MzkdvB9LLMR3eOL0uGx0Te08zIL9&#43;28Iyvkdhgf5o=">
<script defer src="/en.search.min.458fb9bb2012b392febe03660432071a1a7b3968c8a1c5b1fd677e773689a112.js" integrity="sha256-RY&#43;5uyASs5L&#43;vgNmBDIHGhp7OWjIocWx/Wd&#43;dzaJoRI="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  

<link rel="stylesheet" type="text/css" href="//localhost:1313//font-awesome/css/font-awesome.min.css">
<script src="//localhost:1313//js/anchor.min.js"></script>
<script src="//localhost:1313//js/flink.js"></script>


    
    <script>
      var _paq = window._paq = window._paq || [];
       
       
      _paq.push(['disableCookies']);
       
      _paq.push(["setDomains", ["*.flink.apache.org","*.nightlies.apache.org/flink"]]);
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//matomo.privacy.apache.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  

<nav>


<a id="logo" href="//localhost:1313/">
    <img width="70%" src="//localhost:1313//flink-header-logo.svg">
</a>
<p style="text-align:right">&#8203</p>

<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>










  




  
  
    
  
    
  
  

  <input type="checkbox" id="section-16358d95d8c031938f1ecedcfabf20ec" class="toggle"  />
  <label for="section-16358d95d8c031938f1ecedcfabf20ec" class="flex justify-between flink-menu-item">What is Apache Flink?<span>▾</span>
  </label>

    <ul>
    
      <li>
      
  

  
  
    <label for="section-6426d908303b40a8c4163518b9f85188" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/what-is-flink/flink-architecture/" class="">Architecture</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-b90894b3348d928ed138eec343c24da3" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/what-is-flink/flink-applications/" class="">Applications</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-68dd7c29c2b0bd8a5489153742d7f42c" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/what-is-flink/flink-operations/" class="">Operations</a>
    </label>
  

      </li>
    
    </ul>
  

  
    
  
    
  

  
  
    
    
    
<label for="section-f1ecec07350bd6810050d40158878749" class="flex justify-between flink-menu-item">
    <a href="https://nightlies.apache.org/flink/flink-statefun-docs-stable/" style="color:black" class="">What is Stateful Functions? <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

  

  
    
  
    
  

  
  
    
    
    
<label for="section-4113a4c3072cb35f6fd7a0d4e098ee70" class="flex justify-between flink-menu-item">
    <a href="https://nightlies.apache.org/flink/flink-ml-docs-stable/" style="color:black" class="">What is Flink ML? <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

  

  
    
  
    
  

  
  
    
    
    
<label for="section-b39c70259d0abbe2bf1d8d645425f84d" class="flex justify-between flink-menu-item">
    <a href="https://nightlies.apache.org/flink/flink-statefun-docs-stable/" style="color:black" class="">What is the Flink Kubernetes Operator? <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

  

  
    
  
    
  

  
  
    
    
    
<label for="section-53e0b1afcb9ccaf779dc285aa272a014" class="flex justify-between flink-menu-item">
    <a href="https://nightlies.apache.org/flink/flink-table-store-docs-stable/" style="color:black" class="">What is Flink Table Store? <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

  

  
    
  
    
  

  
  
    <label for="section-1264e826d9b04140e72b7ea979e453ce" class="flex justify-between flink-menu-item">
    <a href="/docs/use-cases/" class="">Use Cases</a>
    </label>
  

  

  
    
  
    
  

  
  
    <label for="section-a99f5281cf3cffa0ffd72c84a46ec6ed" class="flex justify-between flink-menu-item">
    <a href="/docs/powered-by/" class="">Powered By</a>
    </label>
  

  

  
  <br/>

  
  
    
  
    
  

  
  
    <label for="section-23af8211b981925b81d51ea7aac5177b" class="flex justify-between flink-menu-item">
    <a href="/docs/downloads/" class="">Downloads</a>
    </label>
  

  

  
    
  
    
  
  

  <input type="checkbox" id="section-f1b7c1b2e5dd43526e77637c475d35b8" class="toggle"  />
  <label for="section-f1b7c1b2e5dd43526e77637c475d35b8" class="flex justify-between flink-menu-item">Getting Started<span>▾</span>
  </label>

    <ul>
    
      <li>
      
  

  
  
    
    
    
<label for="section-f45abaa99ab076108b9a5b94edbc6647" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/try-flink/local_installation/" style="color:black" class="">With Flink <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-efe2166e9dce6f72e126dcc2396b4402" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-statefun-docs-stable/getting-started/project-setup.html" style="color:black" class="">With Flink Stateful Functions <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-7e268d0a469b1093bb33d71d093eb7b9" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-ml-docs-stable/docs/try-flink-ml/quick-start/" style="color:black" class="">With Flink ML <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-cc7147cd0441503127bfaf6f219d4fbb" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-stable/docs/try-flink-kubernetes-operator/quick-start/" style="color:black" class="">With Flink Kubernetes Operator <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-660ca694e416d8ca9176dda52a60d637" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-table-store-docs-stable/docs/try-table-store/quick-start/" style="color:black" class="">With Flink Table Store <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-75db0b47bf4ae9c247aadbba5fbd720d" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/learn-flink/overview/" style="color:black" class="">Training Course <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
    </ul>
  

  
    
  
    
  
  

  <input type="checkbox" id="section-d94c94ce01b910c37d1426ab88722008" class="toggle"  />
  <label for="section-d94c94ce01b910c37d1426ab88722008" class="flex justify-between flink-menu-item">Documentation<span>▾</span>
  </label>

    <ul>
    
      <li>
      
  

  
  
    
    
    
<label for="section-496a3536cfaecabb74f84b14fe7e4dd5" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-docs-stable/" style="color:black" class="">Flink 1.16 (stable) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-8b2fd3efb702be3783ba98d650707e3c" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-docs-master/" style="color:black" class="">Flink Master (snapshot) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-5317a079cddb964c59763c27607f43d9" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-statefun-docs-stable/" style="color:black" class="">Stateful Functions 3.2 (stable) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-25b72f108b7156e94d91b04853d8813a" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-statefun-docs-master" style="color:black" class="">Stateful Functions Master (snapshot) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-00471cb64001e69481840d4b628e4e74" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-ml-docs-stable/" style="color:black" class="">ML 2.1 (stable) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-6d895ec5ad127a29a6a9ce101328ccdf" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-ml-docs-master" style="color:black" class="">ML Master (snapshot) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-e9e531f4d1ec4e71d48416c7db95d964" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-stable/" style="color:black" class="">Kubernetes Operator 1.3 (latest) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-a2c75d90005425982ba8f26ae0e160a3" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-main" style="color:black" class="">Kubernetes Operator Main (snapshot) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-07b85e4b2f61b1526bf202c64460abcd" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-table-store-docs-stable/" style="color:black" class="">Table Store 0.3 (stable) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
      <li>
      
  

  
  
    
    
    
<label for="section-9b9a0032b1e858a34c125d828d1a0718" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="https://nightlies.apache.org/flink/flink-table-store-docs-master/" style="color:black" class="">Table Store Master (snapshot) <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

      </li>
    
    </ul>
  

  
    
  
    
  

  
  
    <label for="section-3cecb1cf64e57b5b8605ef5eafb7aca6" class="flex justify-between flink-menu-item">
    <a href="/docs/getting-help/" class="">Getting Help</a>
    </label>
  

  

  
    
  
    
  

  
  
    
    
    
<label for="section-1d5066022b83f4732dc80f4e9eaa069a" class="flex justify-between flink-menu-item">
    <a href="https://flink-packages.org/" style="color:black" class="">flink-packages.org <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>
  

  

  
  <br/>

  
  
    
  
    
  

  
  
    <label for="section-68d5b1d8d968218070bc0f47c2808fe6" class="flex justify-between flink-menu-item">
    <a href="/docs/community/" class="">Community & Project Info</a>
    </label>
  

  

  
    
  
    
  

  
  
    <label for="section-6c9676d04bcc83fa71363dcc910384b6" class="flex justify-between flink-menu-item">
    <a href="/docs/roadmap/" class="">Roadmap</a>
    </label>
  

  

  
    
  
    
  
  

  <input type="checkbox" id="section-475e0697dc78af4fbb6e9cefbb6bca5d" class="toggle"  />
  <label for="section-475e0697dc78af4fbb6e9cefbb6bca5d" class="flex justify-between flink-menu-item">How to Contribute<span>▾</span>
  </label>

    <ul>
    
      <li>
      
  

  
  
    <label for="section-526780e359726ac277d18547d4a94c43" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/overview/" class="">Overview</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-61f8b74592eb19f72b5d69ce76028bc6" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/contribute-code/" class="">Contribute Code</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-ded112d03122849cf92a5f8734339992" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/reviewing-prs/" class="">Review Pull Requests</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-ad2f7a23b44be83e719ae6c9353f670f" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/code-style-and-quality-preamble/" class="">Code Style and Quality Guide</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-79a9e93c91f0d81bd63e432a26d8ac1c" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/contribute-documentation/" class="">Contribute Documentation</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-eb25ced8645b94b5021950989a7c9f78" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/documentation-style-guide/" class="">Documentation Style Guide</a>
    </label>
  

      </li>
    
      <li>
      
  

  
  
    <label for="section-ff0795cd3fe6f7e97f306e5eabefc848" class="flex justify-between flink-menu-item flink-menu-child">
    <a href="/docs/how-to-contribute/improve-website/" class="">Contribute to the Website</a>
    </label>
  

      </li>
    
    </ul>
  

  
    
  
    
  

  
  
    <label for="section-df630fc1bd1ef0f45f515c779d27c8b5" class="flex justify-between flink-menu-item">
    <a href="/docs/security/" class="">Security</a>
    </label>
  

  

  
  <br/>




  
    
  

  
  
    <label for="section-a07783f405300745807d39eacf150420" class="flex justify-between flink-menu-item">
    <a href="/posts/" class="">Flink Blog</a>
    </label>
  

  

  




















<br/>
<hr class="menu-break">

  
<label for="section-f71a7070dbb7b669824a6441408ded70" class="flex justify-between flink-menu-item">
    <a href="https://github.com/apache/flink" style="color:black" class="">Flink on GitHub <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>

  
<label for="section-2ccaaab8c67f3105bbf7df75faca8027" class="flex justify-between flink-menu-item">
    <a href="https://twitter.com/apacheflink" style="color:black" class="">@ApacheFlink <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label>



<hr class="menu-break">
<table>
  <tr>
    <th colspan="2">
<label for="section-78c2028200542d78f8c1a8f6b4cbb36b" class="flex justify-between flink-menu-item">
    <a href="https://www.apache.org/" style="color:black" class="">Apache Software Foundation <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label></th>
  </tr>
  <tr>
    <td>
<label for="section-794df3791a8c800841516007427a2aa3" class="flex justify-between flink-menu-item">
    <a href="https://www.apache.org/licenses/" style="color:black" class="">License <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label></td>
    <td>
<label for="section-2fae32629d4ef4fc6341f1751b405e45" class="flex justify-between flink-menu-item">
    <a href="https://www.apache.org/security/" style="color:black" class="">Security <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label></td>
  </tr>
  <tr>
    <td>
<label for="section-0584e445d656b83b431227bb80ff0c30" class="flex justify-between flink-menu-item">
    <a href="https://www.apache.org/foundation/sponsorship.html" style="color:black" class="">Donate <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label></td>
    <td>
<label for="section-00d06796e489999226fb5bb27fe1b3b2" class="flex justify-between flink-menu-item">
    <a href="https://www.apache.org/foundation/thanks.html" style="color:black" class="">Thanks <i class="link fa fa-external-link title" aria-hidden="true"></i></a>
</label></td>
  </tr>
</table>

<hr class="menu-break">



  

  







<a  href="//localhost:1313/zh/" class="flex align-center">
  <i class="fa fa-globe" aria-hidden="true"></i>&nbsp;&nbsp;
  中文版
</a>

<script src="//localhost:1313//js/track-search-terms.js"></script>


</nav>




  <script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Memory Management Improvements with Apache Flink 1.10</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    


<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#introduction-to-flinks-memory-model">Introduction to Flink’s memory model</a></li>
    <li><a href="#how-to-set-up-flink-memory">How to set up Flink memory</a></li>
    <li><a href="#other-components">Other components</a>
      <ul>
        <li><a href="#fractions-of-the-total-flink-memory">Fractions of the Total Flink Memory</a></li>
        <li><a href="#more-hints-to-control-the-container-memory-limit">More hints to control the container memory limit</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      




      
<article class="markdown">
    <h1>
        <a href="/posts/2020-04-21-memory-management-improvements-flink-1.10/">Memory Management Improvements with Apache Flink 1.10</a>
    </h1>
    
  April 21, 2020 -



  Andrey Zagrebin




    <p><p>Apache Flink 1.10 comes with significant changes to the memory model of the Task Managers and configuration options for your Flink applications. These recently-introduced changes make Flink more adaptable to all kinds of deployment environments (e.g. Kubernetes, Yarn, Mesos), providing strict control over its memory consumption. In this post, we describe Flink’s memory model, as it stands in Flink 1.10, how to set up and manage memory consumption of your Flink applications and the recent changes the community implemented in the latest Apache Flink release.</p>
<h2 id="introduction-to-flinks-memory-model">
  Introduction to Flink’s memory model
  <a class="anchor" href="#introduction-to-flinks-memory-model">#</a>
</h2>
<p>Having a clear understanding of Apache Flink’s memory model allows you to manage resources for the various workloads more efficiently. The following diagram illustrates the main memory components in Flink:</p>
<center>
<img src="

//localhost:1313//img/blog/2020-04-21-memory-management-improvements-flink-1.10/total-process-memory.svg" width="400px" alt="Flink: Total Process Memory"/>
<br/>
<i><small>Flink: Total Process Memory</small></i>
</center>
<br/>
<p>The Task Manager process is a JVM process. On a high level, its memory consists of the <em>JVM Heap</em> and <em>Off-Heap</em> memory. These types of memory are consumed by Flink directly or by JVM for its specific purposes (i.e. metaspace etc.). There are two major memory consumers within Flink: the user code of job operator tasks and the framework itself consuming memory for internal data structures, network buffers, etc.</p>
<p><strong>Please note that</strong> the user code has direct access to all memory types: <em>JVM Heap, Direct</em> and <em>Native memory</em>. Therefore, Flink cannot really control its allocation and usage. There are however two types of Off-Heap memory which are consumed by tasks and controlled explicitly by Flink:</p>
<ul>
<li><em>Managed Memory</em> (Off-Heap)</li>
<li><em>Network Buffers</em></li>
</ul>
<p>The latter is part of the <em>JVM Direct Memory</em>, allocated for user record data exchange between operator tasks.</p>
<h2 id="how-to-set-up-flink-memory">
  How to set up Flink memory
  <a class="anchor" href="#how-to-set-up-flink-memory">#</a>
</h2>
<p>With the latest release of Flink 1.10 and in order to provide better user experience, the framework comes with both high-level and fine-grained tuning of memory components. There are essentially three alternatives to setting up memory in Task Managers.</p>
<p>The first two — and simplest — alternatives are configuring one of the two following options for total memory available for the JVM process of the Task Manager:</p>
<ul>
<li><em>Total Process Memory</em>: total memory consumed by the Flink Java application (including user code) and by the JVM to run the whole process.</li>
<li><em>Total Flink Memory</em>: only memory consumed by the Flink Java application, including user code but excluding memory allocated by JVM to run it</li>
</ul>
<p>It is advisable to configure the <em>Total Flink Memory</em> for standalone deployments where explicitly declaring how much memory is given to Flink is a common practice, while the outer <em>JVM overhead</em> is of little interest. For the cases of deploying Flink in containerized environments (such as <a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/deployment/kubernetes.html">Kubernetes</a>, <a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/deployment/yarn_setup.html">Yarn</a> or <a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/deployment/mesos.html">Mesos</a>), the <em>Total Process Memory</em> option is recommended instead, because it becomes the size for the total memory of the requested container. Containerized environments usually strictly enforce this memory limit.</p>
<p>If you want more fine-grained control over the size of <em>JVM Heap</em> and <em>Managed Memory</em> (Off-Heap), there is also a second alternative to configure both <em><a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_setup.html#task-operator-heap-memory">Task Heap</a></em> and <em><a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_setup.html#managed-memory">Managed Memory</a></em>. This alternative gives a clear separation between the heap memory and any other memory types.</p>
<p>In line with the community’s efforts to <a href="https://flink.apache.org/news/2019/02/13/unified-batch-streaming-blink.html">unify batch and stream processing</a>, this model works universally for both scenarios. It allows sharing the <em>JVM Heap</em> memory between the user code of operator tasks in any workload and the heap state backend in stream processing scenarios. In a similar way, the <em>Managed Memory</em> can be used for batch spilling and for the RocksDB state backend in streaming.</p>
<p>The remaining memory components are automatically adjusted either based on their default values or additionally configured parameters. Flink also checks the overall consistency. You can find more information about the different memory components in the corresponding <a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_detail.html">documentation</a>. Additionally, you can try different configuration options with the <a href="https://docs.google.com/spreadsheets/d/1mJaMkMPfDJJ-w6nMXALYmTc4XxiV30P5U7DzgwLkSoE/edit#gid=0">configuration spreadsheet</a> of <a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-49%3A&#43;Unified&#43;Memory&#43;Configuration&#43;for&#43;TaskExecutors">FLIP-49</a> and check the corresponding results for your individual case.</p>
<p>If you are migrating from a Flink version older than 1.10, we suggest following the steps in the <a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_migration.html">migration guide</a> of the Flink documentation.</p>
<h2 id="other-components">
  Other components
  <a class="anchor" href="#other-components">#</a>
</h2>
<p>While configuring Flink’s memory, the size of different memory components can either be fixed with the value of the respective option or tuned using multiple options. Below we provide some more insight about the memory setup.</p>
<h3 id="fractions-of-the-total-flink-memory">
  Fractions of the Total Flink Memory
  <a class="anchor" href="#fractions-of-the-total-flink-memory">#</a>
</h3>
<p>This method allows a proportional breakdown of the <em>Total Flink Memory</em> where the <a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_setup.html#managed-memory">Managed Memory</a> (if not set explicitly) and <a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_detail.html#capped-fractionated-components">Network Buffers</a> can take certain fractions of it. The remaining memory is then assigned to the <a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_setup.html#task-operator-heap-memory">Task Heap</a> (if not set explicitly) and other fixed <em>JVM Heap</em> and <em>Off-Heap components</em>. The following picture represents an example of such a setup:</p>
<center>
<img src="

//localhost:1313//img/blog/2020-04-21-memory-management-improvements-flink-1.10/flink-memory-setup.svg" width="800px" alt="Flink: Example of Memory Setup"/>
<br/>
<i><small>Flink: Example of Memory Setup</small></i>
</center>
<br/>
<p><strong>Please note that</strong></p>
<ul>
<li>Flink will verify that the size of the derived <em>Network Memory</em> is between its minimum and maximum value, otherwise Flink’s startup will fail. The maximum and minimum limits have default values which can be overwritten by the respective configuration options.</li>
<li>In general, the configured fractions are treated by Flink as hints. Under certain scenarios, the derived value might not match the fraction. For example, if the <em>Total Flink Memory</em> and the <em>Task Heap</em> are configured to fixed values, the <em>Managed Memory</em> will get a certain fraction and the <em>Network Memory</em> will get the remaining memory which might not exactly match its fraction.</li>
</ul>
<h3 id="more-hints-to-control-the-container-memory-limit">
  More hints to control the container memory limit
  <a class="anchor" href="#more-hints-to-control-the-container-memory-limit">#</a>
</h3>
<p>The heap and direct memory usage are managed by the JVM. There are also many other possible sources of native memory consumption in Apache Flink or its user applications which are not managed by Flink or the JVM. Controlling their limits is often difficult which complicates debugging of potential memory leaks. If Flink’s process allocates too much memory in an unmanaged way, it can often result in killing Task Manager containers in containerized environments. In this case, it may be hard to understand which type of memory consumption has exceeded its limit. Flink 1.10 introduces some specific tuning options to clearly represent such components. Although Flink cannot always enforce strict limits and borders among them, the idea here is to explicitly plan the memory usage. Below we provide some examples of how memory setup can prevent containers exceeding their memory limit:</p>
<ul>
<li>
<p><a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_tuning.html#rocksdb-state-backend">RocksDB state cannot grow too big</a>. The memory consumption of RocksDB state backend is accounted for in the <em>Managed Memory</em>. RocksDB respects its limit by default (only since Flink 1.10). You can increase the <em>Managed Memory</em> size to improve RocksDB’s performance or decrease it to save resources.</p>
</li>
<li>
<p><a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_setup.html#configure-off-heap-memory-direct-or-native">User code or its dependencies consume significant off-heap memory</a>. Tuning the <em>Task Off-Heap</em> option can assign additional direct or native memory to the user code or any of its dependencies. Flink cannot control native allocations but it sets the limit for <em>JVM Direct</em> memory allocations. The <em>Direct</em> memory limit is enforced by the JVM.</p>
</li>
<li>
<p><a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_detail.html#jvm-parameters">JVM metaspace requires additional memory</a>. If you encounter <code>OutOfMemoryError: Metaspace</code>, Flink provides an option to increase its limit and the JVM will ensure that it is not exceeded.</p>
</li>
<li>
<p><a href="//nightlies.apache.org/flinkflink-docs-release-1.10/ops/memory/mem_detail.html#capped-fractionated-components">JVM requires more internal memory</a>. There is no direct control over certain types of JVM process allocations but Flink provides <em>JVM Overhead</em> options. The options allow declaring an additional amount of memory, anticipated for those allocations and not covered by other options.</p>
</li>
</ul>
<h2 id="conclusion">
  Conclusion
  <a class="anchor" href="#conclusion">#</a>
</h2>
<p>The latest Flink release (Flink 1.10) introduces some significant changes to Flink’s memory configuration, making it possible to manage your application memory and debug Flink significantly better than before. Future developments in this area also include adopting a similar memory model for the job manager process in <a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP&#43;116%3A&#43;Unified&#43;Memory&#43;Configuration&#43;for&#43;Job&#43;Managers">FLIP-116</a>, so stay tuned for more additions and features in upcoming releases. If you have any suggestions or questions for the community, we encourage you to sign up to the Apache Flink <a href="https://flink.apache.org/community.html#mailing-lists">mailing lists</a> and become part of the discussion there.</p>
</p>
</article>
 
      

      <footer class="book-footer">
        
  





<a href="https://cwiki.apache.org/confluence/display/FLINK/Flink+Translation+Specifications">Want to contribute translation?</a>
<br><br>
<a href="//github.com/apache/flink-web/edit/asf-site/docs/content/posts/2020-04-21-memory-management-improvements-flink-1.10.md" style="color:black"><i class="fa fa-edit fa-fw"></i>Edit This Page</a>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      


<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#introduction-to-flinks-memory-model">Introduction to Flink’s memory model</a></li>
    <li><a href="#how-to-set-up-flink-memory">How to set up Flink memory</a></li>
    <li><a href="#other-components">Other components</a>
      <ul>
        <li><a href="#fractions-of-the-total-flink-memory">Fractions of the Total Flink Memory</a></li>
        <li><a href="#more-hints-to-control-the-container-memory-limit">More hints to control the container memory limit</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>

 
    </aside>
    <aside class="expand-toc">
      <button class="toc" onclick="expandToc()">
        <i class="fa fa-expand" aria-hidden="true"></i>
      </button>
    </aside>
    
  </main>

  
</body>

</html>












